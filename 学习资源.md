### Lucien 简介

- Lucien 是由 Path Integral 开发的一个 MCP 客户端，它可以连接 MCP 服务器；包含 Canvas、Jupyter 与知识库。
- 参考：[Lucien 使用指南](https://pathintegral.notion.site/how-to-use-lucien)

### 第一部分：背景

#### mcp.science (Page 9)

- 科学 MCP 服务器的开源仓库。
- 更高效地共享知识和专业技能的中心。
- 发现、安装和维护各种科学研究工具的中心。
- MCP.science 服务器可以通过命令轻松连接，例如：`uvx mcp-science python-code-execution`。
- 快速体验（Windows 直接运行）：
  - `uvx mcp-science web-fetch`
  - `uvx mcp-science example-server`

### 第二部分：构建 MCP 服务器

#### 将研究工具与 AI 连接的具体步骤 (Page 11)

1. 环境设置。
2. 开发 MCP 服务器。
3. 连接 MCP 服务器到 MCP 客户端。
4. 分享。

#### 环境设置 (Page 12)

##### 什么是 UV？

UV 是由 Astral 团队开发的现代 Python 包管理器和项目管理工具，专为替代传统的 pip 和 venv 组合而设计。

###### UV 的主要优势
- **极快的速度**：比 pip 快 10-100 倍，使用 Rust 编写
- **统一管理**：包管理、虚拟环境、项目初始化一体化
- **依赖解析**：更智能的依赖冲突检测和解决
- **跨平台兼容**：Windows、Mac、Linux 完全一致的体验
- **现代化设计**：借鉴了 Node.js 的 npm 和 Rust 的 cargo 优秀设计

###### 为什么 MCP 开发推荐使用 UV？
1. **快速环境搭建**：`uv init` 一键创建项目结构
2. **依赖管理简单**：`uv add package` 自动处理版本兼容
3. **虚拟环境自动化**：自动创建和激活虚拟环境
4. **与 mcp.science 生态一致**：官方推荐的工具链

###### UV vs 传统工具对比

| 功能 | 传统方式 | UV 方式 |
|------|----------|---------|
| 创建项目 | `mkdir project && cd project` | `uv init project` |
| 虚拟环境 | `python -m venv .venv && source .venv/bin/activate` | `uv venv`（自动激活） |
| 安装包 | `pip install package` | `uv add package` |
| 依赖文件 | 手动管理 requirements.txt | 自动生成 pyproject.toml |
| 速度 | 慢（网络下载瓶颈） | 快（并行下载+缓存） |

###### 同步依赖：`uv sync`

`uv sync` 命令用于确保当前虚拟环境中的包与 `uv.lock` 文件中定义的依赖项完全同步。这对于团队协作和部署场景非常有用，因为它保证了所有环境都使用相同的精确依赖版本。

```bash
# 确保在项目根目录，且已生成 uv.lock 文件
uv sync
```

该命令会：
- 安装 `uv.lock` 中列出的所有包及其精确版本。
- 卸载虚拟环境中存在但 `uv.lock` 中未列出的任何包。
- 确保虚拟环境的状态与锁文件完全一致。

##### 前置要求
- Python 3.10 或更高版本
- Windows 10 或更高版本（如果使用 Windows）
- 管理员权限（用于安装软件）

##### 详细安装步骤

###### 步骤 1：安装 Python
1. 访问 [Python 官网](https://www.python.org/downloads/)
2. 下载最新版本的 Python（3.10+）
3. 安装时务必勾选 "Add Python to PATH"
4. 验证安装：打开命令提示符输入 `python --version`

###### 步骤 2：安装 uv 包管理器

**Windows 用户：**
```powershell
# 打开 PowerShell（以管理员身份运行）
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

**Mac 用户：**
```bash
# 打开终端
curl -LsSf https://astral.sh/uv/install.sh | sh
```

###### 步骤 3：创建项目文件夹
```bash
# 创建新项目（在当前目录新建 my_mcp_server）
uv init my_mcp_server
cd my_mcp_server

# 安装 MCP CLI（会自动创建并使用 .venv）
uv add "mcp[cli]"

# 激活虚拟环境
# Windows：
.venv\Scripts\activate
# Mac/Linux：
source .venv/bin/activate

# 安装 MCP 依赖
uv add "mcp[cli]"
# 如需访问网络 API（可选），再单独安装 httpx：
uv add httpx
```

###### 验证环境设置
```bash
# 查看 uv 版本
uv --version
# 查看 Python 版本
python --version
# 查看已安装的包
uv pip list
```

#### 构建 MCP 服务器：最简单的例子 (Page 13, 14)

##### 创建服务器文件

###### 步骤 1：创建主文件
```bash
# 在项目目录下创建 main.py
# Windows：
echo. > main.py
# Mac/Linux：
touch main.py
```

###### 步骤 2：编写完整的示例代码

将以下代码复制到 `main.py` 文件中：

```python
#!/usr/bin/env python3
"""
MCP 服务器示例 - 提供基础数学运算和图片功能
"""

import base64
import io
from typing import Any
from mcp.server.fastmcp import FastMCP
from mcp.types import ImageContent, TextContent
from PIL import Image, ImageDraw

# 初始化 FastMCP 服务器（注意：stdio 模式下不要向 stdout 打印任意文本）
mcp = FastMCP("my-mcp-server")

@mcp.tool()
def add(a: float, b: float) -> float:
    """
    将两个数字相加
    
    Args:
        a: 第一个数字
        b: 第二个数字
    
    Returns:
        两数之和
    """
    result = a + b
    return result

@mcp.tool()
def reverse(text: str) -> str:
    """
    反转输入的文本字符串
    
    Args:
        text: 要反转的文本
    
    Returns:
        反转后的文本
    """
    reversed_text = text[::-1]
    return reversed_text

@mcp.tool()
def get_photo_of_flowers() -> list[ImageContent]:
    """
    生成一张简单的花朵图片
    
    Returns:
        包含花朵图片的 ImageContent 列表
    """
    # 创建一个简单的花朵图片
    img = Image.new('RGB', (200, 200), color='lightblue')
    draw = ImageDraw.Draw(img)
    
    # 画花朵
    # 花心
    draw.ellipse([90, 90, 110, 110], fill='yellow')
    
    # 花瓣
    petals = [
        [80, 70, 120, 90],   # 上
        [110, 80, 130, 120], # 右
        [80, 110, 120, 130], # 下
        [70, 80, 90, 120],   # 左
        [85, 75, 105, 95],   # 右上
        [105, 105, 125, 125], # 右下
        [75, 105, 95, 125],  # 左下
        [75, 75, 95, 95],    # 左上
    ]
    
    for petal in petals:
        draw.ellipse(petal, fill='pink')
    
    # 添加花茎
    draw.rectangle([95, 130, 105, 180], fill='green')
    
    # 转换为 base64
    buffer = io.BytesIO()
    img.save(buffer, format='PNG')
    img_base64 = base64.b64encode(buffer.getvalue()).decode()
    
    return [
        ImageContent(
            type="image",
            data=img_base64,
            mimeType="image/png"
        )
    ]

def main():
    """启动 MCP 服务器"""
    # 显式指定 stdio 传输，教学用途
    mcp.run(transport="stdio")

if __name__ == "__main__":
    main()
```

###### 步骤 3：安装额外依赖
```bash
# 安装图像处理库
uv add pillow
```

#### 有用技巧：图像处理 (Page 15)

- 图像需要以 base64 格式作为 `ImageContent` 返回。
- 提供将图像转换为 base64 的示例。

#### 有用技巧：运行子进程 (Page 16)

- 可以使用 `subprocess` 库运行其他应用程序或需要不同环境的 Python 代码。
- 提供运行 `ls` 命令的示例。
- 提醒：subprocess 可能很复杂，遇到问题可寻求 AI 或技术支持团队的帮助。

#### 有用技巧：保存文件 (Page 17)

- 工具可能生成 LLM 不需要看到的文件或数据。
- 保存文件并告知 LLM 其 URI（例如：`data://...`）。
- 提供使用 `BlobResourceContents` 或保存到临时文件并返回 URI 的示例。

#### MCP 服务器：本地测试运行 (Page 18)

##### 测试你的服务器

###### 方法 1：直接运行服务器
```bash
# 确保虚拟环境已激活
python main.py
```

你应该看到类似输出：
```
启动 MCP 示例服务器...
服务器正在运行，等待连接...
```

###### 方法 2：使用 MCP 开发工具
```bash
# 安装 MCP 开发工具
uv add mcp

# 启动开发模式
uv run mcp dev main.py
```

这会：
1. 启动你的 MCP 服务器
2. 提供一个本地 URL（通常是 http://localhost:3000）
3. 打开浏览器显示 MCP Inspector 界面

###### MCP Inspector 使用说明
- **工具列表**：查看服务器提供的所有工具
- **测试工具**：直接在浏览器中测试工具功能
- **查看日志**：监控服务器运行状态
- **调试信息**：查看详细的通信过程

###### 测试示例
在 MCP Inspector 中测试：
1. 测试 `add` 工具：输入参数 a=5, b=3
2. 测试 `reverse` 工具：输入 text="hello world"
3. 测试 `get_photo_of_flowers` 工具：无需参数，会生成花朵图片

### 第三部分：连接 MCP 服务器到 AI Agent

#### 两种类型的 MCP 服务器传输 (Page 22)

- 流式 HTTP / SSE：通常作为 Web 服务托管，最适合访问云资源和工具，构建和维护更复杂。
- stdio（标准 I/O）：MCP 服务器作为本地计算机上的进程运行，通常由 MCP 客户端通过命令启动（uvx、npx、docker），最适合访问本地资源和工具（本地实验设备、私有网络内可访问的计算集群、本地代码、文件和数据），构建和维护更简单。

#### 连接 MCP 服务器与 MCP 客户端 (Page 23)

##### Path Integral 的 Lucien

###### 安装和配置步骤
1. **下载 Lucien**：
   - 访问 [Lucien 官网](https://pathintegral.notion.site/how-to-use-lucien)
   - 根据操作系统下载对应版本

2. **安装 Lucien**：
   - Windows：运行 .exe 安装程序
   - Mac：拖拽到 Applications 文件夹
   - Linux：按照官方文档说明

3. **配置 MCP 服务器**：
   - 启动 Lucien
   - 进入设置 → MCP 服务器
   - 添加本地服务器：
     ```json
     {
       "name": "my-example-server",
       "command": "python",
       "args": ["D:\\你的项目路径\\my_mcp_server\\main.py"],
       "cwd": "D:\\你的项目路径\\my_mcp_server"
     }
     ```

4. **特色功能**：
   - **Canvas**：可视化编程界面
   - **Jupyter**：集成的 Python 笔记本
   - **知识库**：文档和代码片段管理

##### 5ire & Lambda

###### 安装和配置详细步骤

1. **注册获取积分**：
   - 访问 5ire 官网注册账号
   - 申领 400 美元的 Lambda 云计算积分

2. **安装 5ire**：
   ```bash
   # 下载并安装 5ire 客户端
   # 根据操作系统选择对应版本
   ```

3. **配置 Lambda 云服务**：
   - 登录 Lambda Labs
   - 设置 API 密钥
   - 选择 llama-4 模型

4. **配置 LLM 连接**：
   - 打开 5ire 设置
   - 选择 LLM 提供商设置
   - 输入配置：
     ```json
     {
       "apiBase": "https://api.openrouter.ai/api/v1",
       "modelMapping": {
         "gpt-4o-mini": "openai/gpt-4o-mini"
       }
     }
     ```

5. **添加 MCP 工具**：
   - 进入 Tools → New Tool
   - 填写配置：
     - **Tool Key**：`my-example-server`
     - **Display Name**：`我的示例服务器`
     - **Command**：`python`
     - **Arguments**：`["D:\\你的项目路径\\my_mcp_server\\main.py"]`
     - **Working Directory**：`D:\\你的项目路径\\my_mcp_server`
   - 点击保存并启用

##### Claude Desktop

###### 详细安装和配置步骤

1. **下载安装 Claude Desktop**：
   - 访问 [Anthropic 官网](https://claude.ai/download)
   - 选择对应操作系统版本下载
   - Windows：运行 .exe 安装文件
   - Mac：拖拽到 Applications 文件夹

2. **首次设置**：
   - 启动 Claude Desktop
   - 使用 Anthropic 账号登录
   - 了解免费层级限制（每月有令牌速率限制）

3. **配置 MCP 服务器**：

   **步骤 1**：打开配置文件
   - 点击 Settings（设置）
   - 选择 Developer（开发者）
   - 点击 Edit Config（编辑配置）
   - 系统会打开一个 JSON 配置文件

   **步骤 2**：添加服务器配置
   替换配置文件内容为：
   ```json
   {
     "mcpServers": {
       "my-example-server": {
         "command": "python",
         "args": ["D:\\你的项目路径\\my_mcp_server\\main.py"],
         "env": {
           "UV_PROJECT": "D:\\你的项目路径\\my_mcp_server"
         }
       }
     }
   }
   ```

   **步骤 3**：保存并重启
   - 保存配置文件（Ctrl+S）
   - 关闭 Claude Desktop
   - 重新启动应用

4. **验证配置**：
   - 重启后，在输入框下方应该看到 🔨 工具图标
   - 如果看到图标，说明 MCP 服务器已成功加载

5. **首次使用**：
   - 向 Claude 发送测试消息：`请计算 10 加 20`
   - 系统会弹出权限确认对话框
   - 点击 "Allow for this chat"（允许在此对话中使用）
   - Claude 将调用你的 MCP 服务器执行计算

###### 重要注意事项
- **路径设置**：确保配置中的路径是绝对路径
- **环境变量**：`UV_PROJECT` 环境变量指向项目根目录
- **权限管理**：每个新对话都需要重新授权工具使用

##### 示例交互（验证工具可用性）

###### 测试方法
在配置好的客户端中，尝试以下交互：

1. **测试加法工具**：
   - 发送：`请计算 99 加 42`
   - 期待结果：Claude 调用 add 工具，返回 141

2. **测试文本反转工具**：
   - 发送：`请反转文本 'hello world'`
   - 期待结果：返回 'dlrow olleh'

3. **测试图片生成工具**：
   - 发送：`请显示花朵图片`
   - 期待结果：显示一张简单的花朵图片

#### 常见问题与故障排除 (Page 24)

##### 环境相关问题

###### 问题 1：`uv` 命令未找到
**症状**：执行 `uv --version` 提示命令不存在

**解决方案**：
```bash
# Windows - 重新安装 uv
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

# 重启命令行窗口
# 或添加到系统 PATH：C:\Users\你的用户名\.cargo\bin
```

###### 问题 2：Python 版本不兼容
**症状**：提示 Python 版本过低

**解决方案**：
```bash
# 检查 Python 版本
python --version

# 如果版本低于 3.10，需要升级
# 下载最新版本：https://www.python.org/downloads/
```

###### 问题 3：虚拟环境激活失败
**症状**：命令行前缀没有显示 `(venv)`

**解决方案**：
```bash
# Windows
.venv\Scripts\activate.bat

# 如果仍然失败，尝试
.venv\Scripts\Activate.ps1

# Mac/Linux
source .venv/bin/activate
```

##### MCP 服务器问题

###### 问题 4：服务器启动失败
**症状**：`python main.py` 报错

**常见原因和解决方案**：

1. **模块导入错误**：
   ```bash
   # 确保安装了所有依赖
   uv add "mcp[cli]" httpx pillow
   ```

2. **端口被占用**：
   ```bash
   # 查看端口占用
   netstat -ano | findstr :8000
   # 杀死占用进程或更换端口
   ```

3. **权限问题**：
   ```bash
   # 以管理员身份运行命令行
   # 或检查文件夹权限
   ```

##### 客户端连接问题

###### 问题 5：Claude Desktop 看不到工具图标
**检查步骤**：

1. **配置文件语法**：确保 JSON 格式正确
   ```json
   // 正确格式
   {
     "mcpServers": {
       "my-server": {
         "command": "python",
         "args": ["绝对路径\\main.py"]
       }
     }
   }
   ```

2. **路径问题**：
   ```bash
   # 使用绝对路径，不要使用相对路径
   # Windows 示例：
   "args": ["C:\\Users\\YourName\\Documents\\my_mcp_server\\main.py"]
   
   # Mac 示例：
   "args": ["/Users/YourName/Documents/my_mcp_server/main.py"]
   ```

3. **环境变量**：
   ```json
   {
     "mcpServers": {
       "my-server": {
         "command": "python",
         "args": ["绝对路径\\main.py"],
         "env": {
           "UV_PROJECT": "项目根目录绝对路径"
         }
       }
     }
   }
   ```

###### 问题 6：工具调用权限被拒绝
**解决方案**：
- 每次新对话都需要重新授权
- 在工具调用弹窗中点击 "Allow for this chat"
- 如果持续被拒绝，检查服务器是否正常运行

##### 调试技巧

###### 查看详细日志
```bash
# 在服务器代码中添加调试信息
import logging
logging.basicConfig(level=logging.DEBUG)

# 或在 main.py 中添加更多 print 语句
```

###### 使用 MCP Inspector
```bash
# 启动开发模式
mcp dev main.py

# 在浏览器中查看：
# - 工具列表是否完整
# - 测试工具是否正常响应
# - 错误日志详情
```

##### 性能优化建议

1. **减少启动时间**：移除不必要的导入
2. **优化图片处理**：使用更小的图片尺寸
3. **错误处理**：为每个工具添加 try-catch 块

### 第四部分：为 mcp.science 做贡献

#### Fork mcp.science (Page 26)

- 在 GitHub 上 fork `pathintegral-institute/mcp.science` 仓库。

#### 克隆仓库到本地 (Page 27)

- 将 fork 后的仓库克隆到本地。

#### 开发环境设置 (Page 28)

- 在 `servers/` 目录下创建新的服务器目录。
- 提交贡献时创建 PR。
- PR 创建后，服务器可以通过 `uvx mcp-science <server_name> -b <branch_name>` 连接 AI Agent。
- PR 合并后，可以通过 `uvx mcp-science <server_name>` 访问服务器。

#### 使用 jules.google 进行开发 (Page 29)

##### Jules.google 简介
Jules 是 Google 开发的 AI 编程助手，采用全托管、异步模式，特别适合 MCP 服务器开发。

##### 为什么选择 Jules 开发 MCP 服务器
- **免费使用**：目前 Beta 阶段完全免费
- **明确需求导向**：适合有具体功能定义的 MCP 工具开发
- **GitHub 原生集成**：可直接创建 Pull Request 到 mcp.science 仓库
- **异步处理**：适合复杂的服务器逻辑开发

##### 使用 Jules 开发 MCP 服务器步骤

###### 步骤 1：访问 Jules
1. 打开浏览器访问：[jules.google](https://jules.google)
2. 使用 Google 账号登录
3. 了解每日任务额度限制

###### 步骤 2：创建 MCP 项目
1. **新建项目**：
   - 点击 "New Project"
   - 项目名称：`my-mcp-weather-server`
   - 描述：创建一个获取天气信息的 MCP 服务器

2. **项目需求描述**：
   ```
   请帮我创建一个 MCP 服务器，具有以下功能：
   1. 获取指定城市的当前天气
   2. 获取 7 天天气预报
   3. 支持温度单位转换（摄氏度/华氏度）
   4. 使用 OpenWeatherMap API
   5. 包含完整的错误处理
   6. 添加详细的工具说明文档
   ```

###### 步骤 3：代码审查和调整
Jules 生成代码后：
1. **检查代码结构**：确保使用了 FastMCP 框架
2. **验证工具定义**：每个 @mcp.tool() 都有正确的类型提示
3. **测试接口**：确认 API 调用逻辑正确
4. **优化错误处理**：添加必要的异常捕获

###### 步骤 4：集成到 mcp.science
1. **Fork 仓库**：Jules 可以直接 fork pathintegral-institute/mcp.science
2. **创建分支**：在 servers/ 目录下创建新的服务器文件夹
3. **提交代码**：Jules 会自动创建 Pull Request
4. **完善文档**：添加 README.md 和使用示例

##### Jules vs 传统开发对比

| 特性 | Jules | 传统开发 |
|------|--------|----------|
| 学习成本 | 极低，自然语言描述即可 | 需要学习 Python 和 MCP SDK |
| 开发速度 | 快速，几分钟生成完整项目 | 数小时到数天 |
| 代码质量 | 高，遵循最佳实践 | 取决于开发者经验 |
| GitHub 集成 | 自动化，直接创建 PR | 手动操作 |
| 错误处理 | 自动添加 | 需要手动实现 |
| 文档生成 | 自动生成详细文档 | 需要手写 |

##### 适合 Jules 开发的 MCP 场景
1. **API 集成服务器**：连接第三方 API（天气、新闻、股票等）
2. **数据处理工具**：文本处理、格式转换、计算工具
3. **文件操作服务器**：读写文件、格式转换等
4. **科学计算工具**：数学运算、统计分析等

##### 不适合 Jules 的场景
1. **复杂实时系统**：需要持续运行的服务
2. **硬件交互**：需要访问特定硬件设备
3. **超大型项目**：超过 Jules 处理能力范围
4. **高度定制化**：需要精细控制每个细节

##### 使用技巧
1. **明确需求**：提供详细、具体的功能描述
2. **分步骤开发**：将复杂功能拆分为多个简单工具
3. **及时测试**：每个功能完成后立即测试
4. **完善文档**：为每个工具添加清晰的使用说明

### 新手快速入门总结

#### 🚀 完整学习路径（预计用时：2-4 小时）

##### 第一步：环境准备（30 分钟）
1. 安装 Python 3.10+
2. 安装 uv 包管理器
3. 创建虚拟环境
4. 安装 MCP 依赖

##### 第二步：构建第一个服务器（45 分钟）
1. 创建 main.py 文件
2. 复制示例代码（包含加法、反转、图片生成）
3. 本地测试运行
4. 使用 MCP Inspector 验证

##### 第三步：连接到客户端（45 分钟）
选择以下任一客户端：
- **Claude Desktop**（推荐新手）：免费，配置简单
- **Lucien**：功能丰富，适合深度使用
- **5ire + Lambda**：云端运行，适合团队协作

##### 第四步：测试和调试（30 分钟）
1. 发送测试消息验证工具调用
2. 查看错误日志，解决常见问题
3. 优化代码和性能

##### 第五步：贡献到开源（可选，30 分钟）
1. 使用 Jules.google 快速开发新功能
2. Fork mcp.science 仓库
3. 创建 Pull Request

#### 🎯 学习建议

##### 新手优先级
1. **先跟着教程完成一遍**：确保基础环境和流程都通
2. **重点掌握故障排除**：80% 的问题都在环境配置和路径设置
3. **多测试不同工具**：理解 MCP 工具的输入输出规律

##### 进阶方向
1. **学习更多 MCP 概念**：资源、提示、采样等高级功能
2. **集成真实 API**：天气、新闻、股票等外部数据源
3. **性能优化**：处理大量数据和并发请求
4. **部署到云端**：让服务器 24/7 运行

#### ❗ 重要提醒

##### 必须注意的事项
- **路径一定要用绝对路径**：相对路径是 90% 错误的原因
- **虚拟环境要激活**：确保命令行前有 `(venv)` 提示
- **JSON 配置要正确**：一个逗号错误就会导致配置失败
- **权限要授予**：每次新对话都要重新允许工具使用

##### 遇到问题时
1. 先查看"常见问题与故障排除"章节
2. 使用 MCP Inspector 调试
3. 检查命令行输出的错误信息
4. 确认所有依赖都已正确安装

### 参考资料

#### 官方文档
- Getting Started：[Model Context Protocol 文档](https://modelcontextprotocol.io/docs/getting-started/intro)
- 自建 MCP 服务器指南：[How to build your own MCP server](https://github.com/pathintegral-institute/mcp.science/blob/main/docs/how-to-build-your-own-mcp-server-step-by-step.md)
- 集成 MCP 服务器步骤：[Integrate MCP server step-by-step](https://github.com/pathintegral-institute/mcp.science/blob/main/docs/integrate-mcp-server-step-by-step.md)

#### 社区资源
- [mcp.science GitHub 仓库](https://github.com/pathintegral-institute/mcp.science)
- [MCP 中文社区](https://mcp-docs.cn/)
- [Jules.google 官网](https://jules.google)

#### 视频教程
- [从零编写 MCP 并发布上线](https://www.bilibili.com/video/BV1RNTtzMENj/)

---

🎉 **恭喜！** 如果你完成了这个教程，你已经掌握了 MCP 开发的基础知识，可以开始构建自己的智能工具了！
